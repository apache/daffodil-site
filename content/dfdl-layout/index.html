<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Daffodil | Standard DFDL Schema Project Layout</title>
    
    <meta name="author" content="">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/apache/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/apache/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/assets/themes/apache/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" />

  </head>

  <body>

        <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="/"><img src="/assets/themes/apache/img/apache-daffodil-logo.png" alt="Apache Daffodil"/></a></div>
        <nav role="navigation">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/releases">Releases</a></li>
            <li id="documentation">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Docs<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/getting-started/">Getting Started</a></li>
                <li><a href="/examples/">Examples</a></li>
                <li><a href="/docs/latest/javadoc/">Java API</a></li>
                <li><a href="/docs/latest/scaladoc/">Scala API</a></li>
                <li><a href="/docs/dfdl/">DFDL Specification</a></li>
                <li><a href="/unsupported/">Unsupported Features</a></li>
                <li><a href="/faq/">Frequently Asked Questions</a></li>
              </ul>
            </li>
            <li id="community">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Community<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/community">Get Involved</a></li>
                <li><a href="/people">People</a></li>
              </ul>
            </li>
            <li id="development">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Development<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a class="external" href="https://cwiki.apache.org/confluence/display/DAFFODIL/">Wiki</a></li>
                <li><a class="external" href="https://github.com/search?q=repo%3Aapache%2Fdaffodil+repo%3Aapache%2Fdaffodil-site&type=Repositories">GitHub</a></li>
                <li><a class="external" href="https://issues.apache.org/jira/projects/DAFFODIL/">JIRA</a></li>
              </ul>
            </li>
            <li id="apache">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Apache<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="external" href="https://www.apache.org/">Foundation</a></li>
                <li><a class="external" href="https://www.apache.org/licenses/">License</a></li>
                <li><a class="external" href="https://www.apache.org/events/current-event">Events</a></li>
                <li><a class="external" href="https://www.apache.org/security">Security</a></li>
                <li><a class="external" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a class="external" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </div>


<div class="title">
  <div class="container">
    <h2>Standard DFDL Schema Project Layout</h2>
  </div>
</div>



    <div class="container">
      <div class="row">
  <div class="col-md-12">
    <!--

-->

<p>There is a specific way of organizing a DFDL schema project that has been found
to be helpful. It uses specific directory naming conventions and tree structure
to manage name conflicts in a manner similar to how Java package names
correspond to directory names.</p>

<h3 id="quick-start">Quick Start</h3>

<p>To quickly get started and generate this directory structure, you can install
<a href="https://www.scala-sbt.org/">SBT</a> and run the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt new apache/daffodil-schema.g8
</code></pre></div></div>

<p>This prompts for various properties and creates the directory structure
described below, including git and sbt configuration files, a basic DFDL schema
file, and TDML and test files.</p>

<h3 id="conventions">Conventions</h3>

<p>This set of conventions provides a number of benefits:</p>

<ul>
  <li>No name conflicts or ambiguity on classpath if multiple DFDL schemas are used
together</li>
  <li>You can copy multiple DFDL schemas into one directory tree and there will be
no conflicts of file names</li>
  <li>sbt can be used to
    <ul>
      <li>Package the schema into a jar, which can then be on a classpath, become
part of a larger application, etc.</li>
      <li>Auto-download all dependencies of the schema, including Daffodil itself.</li>
      <li>Run a suite of tests via ‘sbt test’</li>
      <li>Publish a local version of the schema for use in other projects that also
follow this layout.</li>
    </ul>
  </li>
  <li>Eclipse IDE for development and test of the schema. Multiple such schemas all
work together without conflict in the IDE.</li>
  <li>Encourages organizing DFDL schemas into reusable libraries.
    <ul>
      <li>A DFDL schema project need not define a whole data format. It can define
a library of pieces to be included/imported by other formats.</li>
    </ul>
  </li>
</ul>

<p>These conventions are actually usable for regular XML-schema projects, that is,
they’re not really DFDL-specific conventions. They’re general conventions for
organizing projects so as to achieve the above benefits.</p>

<h3 id="standard-file-tree">Standard File Tree</h3>

<p>Let’s assume the DFDL schema contains two files named rfmt.dfdl.xsd, and
format.dfdl.xsd, and that our format is named RFormat (rfmt) with an
organization web identity of example.com.</p>

<p>The standard file tree would be:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rfmt/
├── .gitattributes         - Git revision control system 'attributes' (see below)
├── .gitignore             - Git revision control system 'ignore' file (should contain
│                            'target' and 'lib_managed' entries)
├── build.sbt              - Simple Build Tool (sbt) specification file. Edit to change version
│                            of Daffodil needed, or versions of other DFDL schemas needed
├── README.md              - Documentation about the DFDL schema in Markdown file format
├── project/
│   └── build.properties   - Defines the sbt version
└── src/
    ├── main/
    │   └── resources/
    │       └── com/
    │           └── example/
    │               └── rfmt/
    │                   ├── xsd/
    │                   │   ├── rfmt.dfdl.xsd    - Primary RFormat DFDL schema file
    │                   │   └── format.dfdl.xsd  - DFDL schema file imported/included from rfmt.dfdl.xsd
    │                   └── xsl/
    │                       └── xforms.xsl       - Resources other than XSD go in other directories
    └── test/
        ├── resources/
        │   └── com/
        │       └── example/
        │           └── rfmt/
        │               ├── Tests1.tdml          - TDML test files
        │               ├── data/                - Test data files not embedded in a TDML file
        │               │   └── test01.rfmt      - or .bin, .dat, .txt, etc.
        │               └── infosets/            - Test infoset files not embedded in a TDML file
        │                   └── test01.rfmt.xml
        └── scala/
            └── com/
                └── example/
                    └── rfmt/
                        └── Tests1.scala   - Scala test driver file
</code></pre></div></div>

<h3 id="buildsbt">build.sbt</h3>

<p>Use the below template for the build.sbt file:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name</span> <span class="o">:=</span> <span class="s">"dfdl-rfmt"</span>
 
<span class="n">organization</span> <span class="o">:=</span> <span class="s">"com.example"</span>
 
<span class="n">version</span> <span class="o">:=</span> <span class="s">"0.0.1"</span>
 
<span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"2.12.11"</span>
 
<span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"org.apache.daffodil"</span> <span class="o">%%</span> <span class="s">"daffodil-tdml-processor"</span> <span class="o">%</span> <span class="s">"3.0.0"</span> <span class="o">%</span> <span class="s">"test"</span><span class="o">,</span>
  <span class="s">"com.novocode"</span> <span class="o">%</span> <span class="s">"junit-interface"</span> <span class="o">%</span> <span class="s">"0.11"</span> <span class="o">%</span> <span class="s">"test"</span><span class="o">,</span>
  <span class="s">"junit"</span> <span class="o">%</span> <span class="s">"junit"</span> <span class="o">%</span> <span class="s">"4.12"</span> <span class="o">%</span> <span class="s">"test"</span><span class="o">,</span>
<span class="o">)</span>

<span class="n">testOptions</span> <span class="o">+=</span> <span class="nv">Tests</span><span class="o">.</span><span class="py">Argument</span><span class="o">(</span><span class="nv">TestFrameworks</span><span class="o">.</span><span class="py">JUnit</span><span class="o">,</span> <span class="s">"-v"</span><span class="o">)</span>

<span class="n">crossPaths</span> <span class="o">:=</span> <span class="kc">false</span>
</code></pre></div></div>

<p>Edit the version of daffodil-tdml above to match the version you are using.</p>

<h3 id="gitattributes">.gitattributes</h3>

<p>In some cases, git may mangle line endings of files so that they match the line
ending of the system. In most cases, this is done in such a way that it you may
never notice. However, in cases where file formats require specific line
endings, this mangling of test data can lead to test failures. To prevent this,
we recommend that a .gitattributes file be created in the root of the format
directory with the following content to disabling the mangline:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/src/test/resources/**/data/** text=false
</code></pre></div></div>
<p>The above tells git that any test files in the data directory should be treated
as if they were binary, and thus not to mangle newlines.</p>

<h3 id="eclipse-ide">Eclipse IDE</h3>

<p>If you organize your DFDL schema project using the above conventions, and then
run <code class="highlighter-rouge">sbt compile</code>, the <code class="highlighter-rouge">lib_managed</code> directory will be populated. Then if
you create a new Eclipse scala project from the directory tree, Eclipse will
see the <code class="highlighter-rouge">lib_managed</code> directory and construct a classpath containing all
those jars.</p>

<h3 id="xsd-conventions">XSD Conventions</h3>

<p>DFDL schemas should have the <code class="highlighter-rouge">.dfdl.xsd</code> suffix to distinguish them from
ordinary XML Schema files.</p>

<p>A DFDL schema should have a target namespace.</p>

<p>Stylistically, the XSD <code class="highlighter-rouge">elementFormDefault="unqualified"</code> is the preferred
style for DFDL schemas.</p>

<h3 id="using-a-dfdl-schema">Using a DFDL Schema</h3>

<p>The <code class="highlighter-rouge">xs:include</code> or <code class="highlighter-rouge">xs:import</code> elements of a DFDL Schema can
import/include a DFDL schema that follows these conventions like this:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:import</span> <span class="na">namespace=</span><span class="s">"urn:example.com/rfmt"</span> <span class="na">schemaLocation=</span><span class="s">"com/example/rfmt/xsd/rfmt.dfdl.xsd"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>The above is for using a DFDL schema as a library, from another different DFDL
schema.</p>

<p>Within a DFDL schema, one DFDL schema file can reference another peer file that
appears in the same directory (the src/main/resources/…/xsd directory) via:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:include</span> <span class="na">schemaLocation=</span><span class="s">"format.dfdl.xsd"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>That is, peer files need not carry the long <code class="highlighter-rouge">com/example/rfmt/xsd/</code> prefix
that makes the reference globally unique.</p>

<p>However, if one schema wants to include another different schema, then this
standard way of organizing schema projects ensures that when packaged into jar
files, the <code class="highlighter-rouge">/src/main/resources</code> directory contents are at the “root” of the
jar file so that the <code class="highlighter-rouge">schemaLocation</code> of the <code class="highlighter-rouge">xs:import</code> or <code class="highlighter-rouge">xs:include</code>
containing the fully qualified path (<code class="highlighter-rouge">com/example/rfmt/xsd/rfmt.dfdl.xsd</code>)
will be found on the <code class="highlighter-rouge">CLASSPATH</code> unambiguously. This convention is what
allows the schema files themselves to have short names like rfmt.dfdl.xsd, and
format.dfdl.xsd. Those names only need to be unique within a single schema
project. Across schema projects our standard DFDL schema project layout insures
unambiguous qualification is available.</p>

<h3 id="git-revision-control">Git Revision Control</h3>

<p>You don’t have to use Git version control, but many people do, and github.com
is one of the reasons for this popularity.</p>

<p>Each DFDL schema should have its own Git repository if it is going to be
revised independently. We encourage users to join the
<a href="https://dfdlschemas.github.io/">DFDLSchemas</a> project on github and create
repositories and publish schemas for any publicly-available formats there. For
other formats that are not publicly available, one may want to put a
placeholder for them on DFDLSchemas anyway (as IBM has done for some formats
like Swift-MT.)</p>

<h3 id="jar-file-packaging">Jar File Packaging</h3>

<p>A DFDL schema using the recommended file structure as described here, can be
packaged into a jar for convenient import/include from other schemas.</p>

<p>The sbt command does all the work:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt package      <span class="c"># creates jar</span>
sbt publishLocal <span class="c"># puts it into local .ivy2 cache where other maven/sbt will find it.</span>
</code></pre></div></div>

<p>The resulting jar has the src/main/resources directory in it at the root of the
jar. If this jar is on the classpath, then other schemas containing XSD import
or include statements will search the jar with the schema location.</p>

<p>That enables a different schema’s <code class="highlighter-rouge">build.sbt</code> to contain a library dependency
on our hypthetical dfdl-rfmt schema using a dependency like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"com.example"</span> <span class="o">%</span> <span class="s">"dfdl-rfmt"</span> <span class="o">%</span> <span class="s">"0.0.1"</span> <span class="o">%</span> <span class="s">"test"</span>
</code></pre></div></div>

<p>That will result in the contents of the <code class="highlighter-rouge">src/main/resources</code> directory above
being on the classpath. XSD include and import statements search the classpath
directories.</p>

  </div>
</div>


      <footer>
        <footer class="site-footer">
    <div class="wrapper">
        <div class="footer-col-wrapper" style="font-size: .85em;">
            <hr>
            <div>
                <div style="text-align: center;">
                    Copyright &copy; 2021 <a href="https://www.apache.org">The Apache Software Foundation</a>.
                    Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
                    2.0</a>.
                    <br>
                    Apache, Apache Daffodil, Daffodil, and the Apache Daffodil logo
                    are trademarks of The Apache Software Foundation.
                </div>
            </div>
        </div>
    </div>
</footer>

      </footer>
    </div>

    <script src="/assets/themes/apache/jquery/jquery-2.1.1.min.js"></script>

    <script src="/assets/themes/apache/bootstrap/js/bootstrap.min.js"></script>


  </body>
</html>

