<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Daffodil | </title>
    
    <meta name="author" content="">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/apache/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/apache/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/assets/themes/apache/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" />

  </head>

  <body>

        <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="/"><img src="/assets/themes/apache/img/apache-daffodil-logo.png" alt="Apache Daffodil"/></a></div>
        <nav role="navigation">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/releases">Releases</a></li>
            <li><a href="/vscode">VSCode</a></li>
            <li id="documentation">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Docs<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/getting-started/">Getting Started</a></li>
                <li><a href="/examples/">Examples</a></li>
                <li><a href="/docs/latest/javadoc/">Java API</a></li>
                <li><a href="/docs/latest/scaladoc/">Scala API</a></li>
                <li><a href="/docs/dfdl/">DFDL Specification</a></li>
                <li><a href="/unsupported/">Unsupported Features</a></li>
                <li><a href="/faq/">Frequently Asked Questions</a></li>
              </ul>
            </li>
            <li id="community">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Community<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/community">Get Involved</a></li>
                <li><a href="/people">People</a></li>
              </ul>
            </li>
            <li id="development">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Development<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a class="external" href="https://cwiki.apache.org/confluence/display/DAFFODIL/">Wiki</a></li>
                <li><a class="external" href="https://github.com/apache/?q=daffodil">GitHub</a></li>
                <li><a class="external" href="https://issues.apache.org/jira/projects/DAFFODIL/">JIRA</a></li>
              </ul>
            </li>
            <li id="apache">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Apache<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="external" href="https://www.apache.org/">Foundation</a></li>
                <li><a class="external" href="https://www.apache.org/licenses/">License</a></li>
                <li><a class="external" href="https://www.apache.org/events/current-event">Events</a></li>
                <li><a class="external" href="https://www.apache.org/security">Security</a></li>
                <li><a class="external" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a class="external" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </div>


<div class="title">
  <div class="container">
    <h2></h2>
  </div>
</div>



    <div class="container">
      <div class="row">
  <div class="col-md-12">
    <div class="sect1">
<h2 id="hidden-groups">Hidden Groups</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>The DFDL language enables groups to be hidden, meaning not part of the logical infoset.</p>
</div>
<div class="paragraph">
<p>This is achieved by way of <em>hidden group references</em>.
This implies that a global group definition can be referenced from some group references which are ordinary, non-hidden, group references, and from other hidden group references.
Hence, the contents of the group definition are not themselves inherently hidden or not, as the hiddenness is based on how the group is referenced.</p>
</div>
<div class="paragraph">
<p>Of course if all uses of a particular group definition are hidden group references, then the schema compiler could provide that all elements within that group are always hidden.
This is expected to be fairly common, as often hidden groups are designed to contain the hidden reprsentation details of data that has a simpler logical appearance in the infoset.</p>
</div>
<div class="paragraph">
<p>Nevertheless, Daffodil must accomodate that the same group definition can be used both in hidden and non-hidden manners.</p>
</div>
</div>
<div class="sect2">
<h3 id="static-analysis-by-the-schema-compiler-i-e-there-is-none">Static Analysis by the Schema Compiler (i.e., there is none)</h3>
<div class="paragraph">
<p>The schema compiler could provide information about whether a given term of the schema is always hidden, sometimes hidden, or never hidden.
However, the runtime overheads are anticipated to be so small that optimizations based on this information are expected to be unnecessary.
Hence, no static analysis of whether a term is always/sometimes/never hidden is performed.</p>
</div>
</div>
<div class="sect2">
<h3 id="runtime-principles-of-operation">Runtime Principles of Operation</h3>
<div class="paragraph">
<p>The implementation takes advantage of the processor (parser/unparser) traversal of the DFDL schema components following an in-order traversal pattern, so that a stack-discpline can be used when traversing hidden-group references. No actual stack is needed, only a counter.
The details are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PState/UState contains a hiddenDepth counter (initial value 0) that represents the number of hidden group references currently in the nest.</p>
</li>
<li>
<p>When parsing/unparsing a hidden group ref, this counter is incremented.
When unwinding from that parse/unparse, the counter is decremented.
No action is required for non-hidden group references.</p>
</li>
<li>
<p>When an infoset element is created, the setHidden() method is called if the counter is non-zero.</p>
</li>
<li>
<p>At the end of processing, the counter should be zero.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="runtime-data-structures-runtime-1">Runtime Data Structures - Runtime 1</h3>
<div class="paragraph">
<p>In Daffodil&#8217;s "Runtime 1" backend, these are the runtime data structure features to support hidden group references:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infoset elements have an isHidden() boolean method, and a setHidden() setter.</p>
</li>
<li>
<p>The PState/UState contains the counter described above.</p>
</li>
<li>
<p>The increment/decrement logic is centralized in a HiddenGroupCombinatorParser/Unparser. This is wrapped around the gram in the ModelGroupGrammarMixin trait, if the gram is a hidden group ref.</p>
</li>
<li>
<p>At the end of processing where checking that the various runtime-stacks and pools are properly emptied/restored, an additional check is done to insure the hidden counter of the PState/UState has been returned to zero.
This check need only be performed on normal exits. If the processor terminates abnormally, we needn&#8217;t check.</p>
</li>
<li>
<p>The debugger/trace should display, as part of the state, whether the current context isHidden (counter &gt; 0) or not.</p>
</li>
<li>
<p>Parser backtracking must save/restore the counter.</p>
</li>
<li>
<p>Unparser suspended UStates do not need to copy the counter value. That is, this counter need only exist in UStateMain.</p>
<div class="ulist">
<ul>
<li>
<p>This holds because infoset elements are created as part of the state of suspensions, and those infoset elements will have setHidden() called or not depending on the counter. Hence, the counter value of a suspended UState is not needed when evaluating a suspension.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="testing">Testing</h3>
<div class="ulist">
<ul>
<li>
<p>Tests cover where the same group definition is used both hidden and non-hidden within the same schema.</p>
</li>
<li>
<p>Tests cover this for hidden sequences and hidden choices.
Note that a hidden group references always uses an xs:sequence element, but the referenced group can be a choice group definition.</p>
</li>
<li>
<p>Tests cover the cases of nested hidden group refs</p>
</li>
</ul>
</div>
</div>
</div>
</div>
  </div>
</div>


      <footer>
        <footer class="site-footer">
    <div class="wrapper">
        <div class="footer-col-wrapper" style="font-size: .85em;">
            <hr>
            <div>
                <div style="text-align: center;">
                    Copyright &copy; 2021 <a href="https://www.apache.org">The Apache Software Foundation</a>.
                    Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
                    2.0</a>.
                    <br>
                    Apache, Apache Daffodil, Daffodil, and the Apache Daffodil logo
                    are trademarks of The Apache Software Foundation.
                </div>
            </div>
        </div>
    </div>
</footer>

      </footer>
    </div>

    <script src="/assets/themes/apache/jquery/jquery-2.1.1.min.js"></script>

    <script src="/assets/themes/apache/bootstrap/js/bootstrap.min.js"></script>


  </body>
</html>

