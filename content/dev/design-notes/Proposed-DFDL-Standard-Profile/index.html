<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Daffodil | Proposal - DFDL Standard Profile</title>
    
    <meta name="author" content="">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/apache/img/apache-daffodil-icon.png" rel="icon" type="image/png">

    <link href="/assets/themes/apache/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/apache/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/assets/themes/apache/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" />

  </head>

  <body>

        <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="/"><img src="/assets/themes/apache/img/apache-daffodil-logo.png" alt="Apache Daffodil"/></a></div>
        <nav role="navigation">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/releases">Releases</a></li>
            <li id="extensions">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Extensions<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/vscode">VS Code</a></li>
                <li><a href="/sbt">SBT</a></li>
              </ul>
            </li>
            <li id="documentation">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Docs<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/getting-started/">Getting Started</a></li>
                <li><a href="/dfdl-training/">DFDL Training</a></li>
                <li><a href="/dfdl-best-practices/">Best Practices for DFDL Schemas</a></li>
                <li><a href="/examples/">Examples</a></li>
                <li><a href="/docs/latest/javadoc/">API</a></li>
                <li><a href="/docs/dfdl/">DFDL Specification</a></li>
                <li><a href="/unsupported/">Unsupported Features</a></li>
                <li><a href="/faq/">Frequently Asked Questions</a></li>
                <li><a href="/dfdl-extensions/">Daffodil DFDL Language Extensions</a></li>
              </ul>
            </li>
            <li id="community">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Community<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a href="/community">Get Involved</a></li>
                <li><a href="/people">People</a></li>
              </ul>
            </li>
            <li id="development">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Development<b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-left">
                <li><a class="external" href="https://cwiki.apache.org/confluence/display/DAFFODIL/">Wiki</a></li>
                <li><a class="external" href="https://github.com/apache/?q=daffodil">GitHub</a></li>
                <li><a class="external" href="https://issues.apache.org/jira/projects/DAFFODIL/">JIRA</a></li>
              </ul>
            </li>
            <li id="apache">
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Apache<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="external" href="https://www.apache.org/">Foundation</a></li>
                <li><a class="external" href="https://www.apache.org/licenses/">License</a></li>
                <li><a class="external" href="https://www.apache.org/events/current-event">Events</a></li>
                <li><a class="external" href="https://www.apache.org/security">Security</a></li>
                <li><a class="external" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a class="external" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                <li><a class="external" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </div>




<div class="title">
  <div class="container"></div>
</div>
<div class="container">
  <h1>Proposal - DFDL Standard Profile</h1>
</div>



    <div class="container">
      <div class="row">
  <div class="col-md-12">
    <!--

-->

<p><em>Version  0.3  2023-12-08</em></p>

<h2 id="introduction">Introduction</h2>

<p>In attempting to integrate Apache Daffodil with other data processing software, the need to make
DFDL schemas interoperate properly in conjunction with other data models has arisen.</p>

<p>Other tools such as Apache NiFi, Apache Drill, Apache Spark, etc. have data models which are
powerful, but not as expressive as DFDL.</p>

<p>DFDL's data model is a simplification of 
<a href="https://www.w3.org/XML/2002/05/psvi-use-cases">XML Schemas's Post Schema Validation Infoset (PSVI)</a>;
however, even this causes problems.
Most other data processing systems were not designed with markup languages in mind, but rather for
structured data.</p>

<p>The following things are allowed in DFDL v1.0, but are difficult to map into most data models:</p>

<ul>
  <li>anonymous choices</li>
  <li>duplicate element child names</li>
  <li>namespaces that are different, but where the prefixes are not unique</li>
  <li>global names for element children</li>
</ul>

<p>A more restrictive subset of DFDL, a <em>standard profile</em>, is needed which can be enforced (on
request) to ensure that DFDL schemas will be usable with a variety of data processing systems.
Creating DFDL schemas that adhere to this standard profile ensures maximal interoperability,
including the ability to convert into JSON without name/namespace collisions.</p>

<p>This is a proposal for a switch/option to be added to Daffodil which turns on enforcement of this
standard profile (which is a subset of DFDL).</p>

<h2 id="standard-profile-restrictions">Standard Profile Restrictions</h2>

<h3 id="no-anonymous-choices">No Anonymous Choices</h3>

<p>Choices must be the model groups of complex type definitions and are not allowed in any other
context.</p>

<p>Each choice branch must begin with a different element. (This is already a XML Schema requirement -
Unique Particle Attribution.)</p>

<h3 id="group-references-cannot-carry-dfdl-properties">Group References Cannot Carry DFDL Properties</h3>

<p>Group references are allowed, but DFDL format properties cannot be expressed on group references; hence,
combining those properties with those of the group definition is not required.</p>

<p>Note that dfdl:assert, dfdl:discriminator and other DFDL <em>statements</em>, not format properties.
These may be expressed in group definitions, but not on group references.</p>

<p>While most data structure systems do not have this notion of reusable groups, when restricted as 
described, reusable groups are something users could implement by way of a simple macro 
pre-processor, so having this in the standard profile really does not create any particular 
challenge when mapping from DFDL standard profile schemas into any data structure system.</p>

<p>Groups and group references are used heavily in DFDL schemas to push down complexity like 
discriminators that are reused in many places.
Allowing groups and group references reduces the difficulty of converting many large DFDL 
schemas to conform to the standard profile, and makes this possible without introducing many 
otherwise unneeded element and type definitions.</p>

<h3 id="no-element-references">No Element References</h3>

<p>There is no corresponding form of sharing in most data structure systems.</p>

<h3 id="no-namespace-qualified-names">No Namespace-Qualified Names</h3>

<p>Only elementFormDefault 'unqualified' is allowed.
Note that this is the default for XML Schema and DFDL.</p>

<h3 id="unique-namespace-prefixes">Unique Namespace Prefixes</h3>

<p>All namespace prefixes must be unique in the entire schema.</p>

<p>This enables one to create unique identifiers by concatenating prefix_local to create global names.</p>

<h3 id="all-element-children-have-unique-names">All Element Children Have Unique Names</h3>

<p>All children element declarations must have unique names within their enclosing parent element.</p>

<h4 id="discussion">Discussion</h4>

<p>Note that this causes issues in a number of large DFDL schemas which attempt to implement a 
single DFDL schema that is capable of handling multiple versions of the data format.</p>

<p>In this case, the schema uses a construct like:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;choice</span> <span class="na">dfdl:choiceDispatchKey=</span><span class="s">"{ ... }"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;sequence</span> <span class="na">dfdl:choiceBranchKey=</span><span class="s">"C"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"VersionC"</span> <span class="na">type=</span><span class="s">"zString"</span><span class="nt">/&gt;</span><span class="c">&lt;!-- zero-length string --&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"hdr"</span> <span class="na">type=</span><span class="s">"hdr_version_C_type"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/sequence&gt;</span>
  <span class="nt">&lt;sequence</span> <span class="na">dfdl:choiceBranchKey=</span><span class="s">"D"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"VersionD"</span> <span class="na">type=</span><span class="s">"zString"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"hdr"</span> <span class="na">type=</span><span class="s">"hdr_version_D_type"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/sequence&gt;</span>
<span class="nt">&lt;/choice&gt;</span>
</code></pre></div></div>
<p>In the above, you can see that there are two separate element declarations named hdr, of different types. 
This allows common sub-structure that is the same in versions C and D to be addressed by path expressions that are
polymorphic. They do not have a path step component that identifies the version.</p>

<p>However, if we require all children to have unique names, then this would have to be elements with distinct names on each
branch such as hdrC and hdrD, and then paths, even those reaching sub-fields that are common to both versions, 
have path steps that are specifically requesting a particular version.</p>

<p>This is a bit painful particularly if there are few differences between versions, and many expressions that
need to reference into the common fields, because
all such expressions would need to be duplicated for version C and version D.</p>

<p>An alternative solution is that this could be overcome by a way of creating path expressions with wildcards in 
them eg., "…/hdr*/…".
An extension of this kind in DFDL has already been proposed/discussed some time ago by the DFDL workgroup, but has 
not yet turned into a formal proposal. (The DFDL4Space implementation by the ESA has a kind of wildcard feature like
this as a DFDL extension.)</p>

<p>Another way of addressing this is to refactor the schema to put common fields outside the choice, and 
have a version-driven choice only for points where the different versions diverge.
This has a downside in that one point in the schema which is version sensitive becomes perhaps many such points, so 
the places where version-distinctions are required are less predictable to a schema user.</p>

<p>This also requires a more sophisticated DFDL schema generator that takes into account multiple versions, computing their 
deltas, and generating common schema when it can. 
This is, however, not the way some large schemas were created, as these schemas are machine generated from the 
individual format specifications, without performing an analysis of what is common and what is unique.</p>

<h3 id="nillable-simple-types-only-tbd-may-not-be-necessary">Nillable Simple Types Only (TBD: May not be necessary)</h3>

<p>Nillable is allowed only for simple type elements.</p>

<p>Note that in DFDL, element declarations express nillability, not type definitions.</p>

<h4 id="rationale">Rationale</h4>

<p>DFDL does not allow the same representation for nilled complex elements as it does for nilled simple elements. 
The representation DFDL allows for nillable complex types is only empty string whereas for simple types a variety of 
dfdl:nilValue values can be expressed.</p>

<p>Hence, omitting this feature removes an awkward corner case.</p>

<h3 id="element-nameidentifier-restrictions">Element Name/Identifier Restrictions</h3>

<p>Element names must consist of all non-whitespace characters from the
Unicode basic multilingual plane (no surrogate pairs in element names).</p>

<p>They may not contain any control characters (Unicode class Cc) and may not contain various punctuation
characters (Unicode classes Ps, Pe, Pd, Pc, Pf, Pi, Po, nor $).</p>

<p>This is a lowest-common denominator of identifier rules intended to allow
DFDL schema identifiers to be mapped into ANY programming language or
structure declaration language, while at the same time allowing use of
Unicode characters.</p>

<p>Element names may not begin with a digit.</p>

<p>Users are encouraged to use "A-Za-Z0-9" only as some systems may not allow use of Unicode characters in
identifiers.</p>

<p>Element names may not begin with any prefix defined as part of the schema
followed by an "<em>" as this could be ambiguous with names being made globally
unique by appending prefix, "</em>" and local name.</p>

<h3 id="string-content-restrictions">String Content Restrictions</h3>

<p>Schemas may only be written in UTF-8 encoding.</p>

<h4 id="rationale-1">Rationale</h4>

<p>Simplify implementations.</p>

<h3 id="import-schemalocation">Import <code class="language-plaintext highlighter-rouge">schemaLocation</code></h3>

<p>Imported files - a namespace must be imported from a single unique imported file. 
A single schema may not contain different import statements for the same
namespace which specify different files.</p>

<p>This is a practical requirement in XML Schema and in Apache Daffodil today, but should be made explicit.</p>

<p>If the <code class="language-plaintext highlighter-rouge">schemaLocation</code> begins with a "/" it is interpreted as an absolute path, otherwise a
relative path. Both may be interpreted relative to a classpath.</p>

<h2 id="existing-dfdl-restrictions">Existing DFDL Restrictions</h2>

<p>Just as a reminder, the above standard-profile restrictions go on top of DFDL
existing limitations on XML Schema such as:</p>

<ul>
  <li>arrays/optional - only for elements</li>
  <li>no mixed content</li>
  <li>no complex type derivation</li>
  <li>no attributes</li>
  <li>limited set of simple types</li>
  <li>pattern facets only for xs:string elements</li>
  <li>other facet restrictions by type</li>
</ul>

<h2 id="possible-additional-restrictions">Possible additional restrictions</h2>

<h3 id="troublesome-placement-of-dfdlassert-and-dfdldiscriminator-on-sequences--choices">Troublesome Placement of dfdl:assert and dfdl:discriminator on Sequences &amp; Choices</h3>

<p>The DFDL v1.0 rules about sequences/choices and statement annotations on them are confusing.
In particular, a dfdl:assert or dfdl:discriminator with testKind 'expression' appears lexically at
the top of the sequence/choice, but is executed after the sequence/choice content has been parsed.</p>

<p>This is sufficiently error-prone that the standard profile should disallow
it, requiring instead that an inner sequence carrying the assertion or
discriminator with NO child content, be inserted in the sequence at the
point where the evaluation is required to occur.</p>

<p>Requesting/Enabling the Standard Profile</p>

<p>If the standard profile is requested, then use of constructs outside of the standard profile is a
Schema Definition Error.</p>

<h2 id="use-cases">Use Cases</h2>

<p>A DFDL schema author may want to, by default, state that they want to conform to the standard profile
for new DFDL schemas they create.
The purpose of this is to maximize the utility of these new schemas when used with a variety of data systems.</p>

<p>However, a DFDL schema author may also have a mixture of DFDL schema projects they use or maintain, and some of them
may pre-date or intentionally not use the standard profile; hence, individual schema projects must be able to 
carry a declared intention of whether they do, or do not, expect to adhere to the standard profile.</p>

<p>Finally, an individual schema project may contain a variety of subsections, some of which use the standard profile, and 
some of which do not; hence, individual DFDL schema files must be able to declare their use of the standard profile, or
intention to not use it.</p>

<h3 id="mechanisms-for-requesting-the-standard-profile">Mechanisms for Requesting the Standard Profile</h3>

<p>The following ways should be available for a schema author to tell Daffodil they want enforcement of
the standard profile (or not).</p>

<ul>
  <li><em>Home Directory Properties File</em> - a file such as ~/.daffodil or daffodil.properties should
contain a default value for choosing the standard profile. This default value can be overridden by
other mechanisms which have higher priority.</li>
  <li>
    <p><em>Schema Project Properties File</em> - a Daffodil config file at the root of the Daffodil schema
project directory tree, should be able to specify a default value for use by the schema project.</p>

    <p>If the XML config file system is superceded by some other properties file per-schema, then that
same file should enable specifying the standard profile is (or is not) to be used.</p>
  </li>
  <li>
    <p><em>Per Schema-File property</em> - A property expessed at the top level of a DFDL schema file should
indicate that the standard profile is requested.</p>

    <p>All schemas imported or included by a schema that requests the standard profile would be assumed
to also be required to obey the standard profile.</p>

    <p>However, the inverse is not true. Including/importing a schema file that requests the standard profile does not
change the profile behavior (using or not) of the schema doing the include/import.</p>
  </li>
  <li><em>Command Line Interface (CLI) Option</em> - The daffodil CLI should take an option (perhaps 
–standard-profile yes/no) telling it the 
schema is expected to obey the standard profile. The CLI should also obey the other mechanisms 
listed here. The CLI flag should override properties files (homedir, or schema project 
expressed), but not things specified directly in the schema files themselves.</li>
</ul>

<p>An opposite expression - that a schema explicitly is known to require more than the
standard profile, should also be allowed to be placed in any of these locations.</p>

<p>Including such an explicitly non-standard-profile schema into a schema that requests the standard
profile should cause a Schema Definition Error. 
The inverse however, is not true. 
A schema that explicitly obeys the standard profile can be included/imported into any schema.</p>


  </div>
</div>


      <footer>
        <footer class="site-footer">
    <div class="wrapper">
        <div class="footer-col-wrapper" style="font-size: .85em;">
            <hr>
            <div>
                <div style="text-align: center;">
                    Copyright &copy; 2025 <a href="https://www.apache.org">The Apache Software Foundation</a>.
                    Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
                    2.0</a>.
                    <br>
                    Apache, Apache Daffodil, Daffodil, and the Apache Daffodil logo
                    are trademarks of The Apache Software Foundation.
                </div>
            </div>
        </div>
    </div>
</footer>

      </footer>
    </div>

    <script src="/assets/themes/apache/jquery/jquery-2.1.1.min.js"></script>

    <script src="/assets/themes/apache/bootstrap/js/bootstrap.min.js"></script>


  </body>
</html>

