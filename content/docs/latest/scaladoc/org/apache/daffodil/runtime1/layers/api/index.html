<!DOCTYPE html >
<html>
        <head>
          <meta http-equiv="X-UA-Compatible" content="IE=edge" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
          <title>Apache Daffodil 3.9.0 Scala API  - org.apache.daffodil.runtime1.layers.api</title>
          <meta name="description" content="Apache Daffodil 3.9.0 Scala API - org.apache.daffodil.runtime1.layers.api" />
          <meta name="keywords" content="Apache Daffodil 3.9.0 Scala API org.apache.daffodil.runtime1.layers.api" />
          <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
          
      
      <link href="../../../../../../lib/index.css" media="screen" type="text/css" rel="stylesheet" />
      <link href="../../../../../../lib/template.css" media="screen" type="text/css" rel="stylesheet" />
      <link href="../../../../../../lib/diagrams.css" media="screen" type="text/css" rel="stylesheet" id="diagrams-css" />
      <script type="text/javascript" src="../../../../../../lib/jquery.min.js"></script>
      <script type="text/javascript" src="../../../../../../lib/jquery.panzoom.min.js"></script>
      <script type="text/javascript" src="../../../../../../lib/jquery.mousewheel.min.js"></script>
      <script type="text/javascript" src="../../../../../../lib/index.js"></script>
      <script type="text/javascript" src="../../../../../../index.js"></script>
      <script type="text/javascript" src="../../../../../../lib/scheduler.js"></script>
      <script type="text/javascript" src="../../../../../../lib/template.js"></script>
      
      <script type="text/javascript">
        /* this variable can be used by the JS to determine the path to the root document */
        var toRoot = '../../../../../../';
      </script>
    
        </head>
        <body>
      <div id="search">
        <span id="doc-title">Apache Daffodil 3.9.0 Scala API<span id="doc-version"></span></span>
        <span class="close-results"><span class="left">&lt;</span> Back</span>
        <div id="textfilter">
          <span class="input">
            <input autocapitalize="none" placeholder="Search" id="index-input" type="text" accesskey="/" />
            <i class="clear material-icons"></i>
            <i id="search-icon" class="material-icons"></i>
          </span>
        </div>
    </div>
      <div id="search-results">
        <div id="search-progress">
          <div id="progress-fill"></div>
        </div>
        <div id="results-content">
          <div id="entity-results"></div>
          <div id="member-results"></div>
        </div>
      </div>
      <div id="content-scroll-container" style="-webkit-overflow-scrolling: touch;">
        <div id="content-container" style="-webkit-overflow-scrolling: touch;">
          <div id="subpackage-spacer">
            <div id="packages">
              <h1>Packages</h1>
              <ul>
                <li name="_root_.root" visbl="pub" class="indented0 " data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="_root_"></a><a id="root:_root_"></a>
      <span class="permalink">
      <a href="../../../../../../index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <a title="This is the documentation for the Apache Daffodil Scala API." href="../../../../../../index.html"><span class="name">root</span></a>
      </span>
      
      <p class="shortcomment cmt">This is the documentation for the Apache Daffodil Scala API.</p><div class="fullcomment"><div class="comment cmt"><p>This is the documentation for the Apache Daffodil Scala API.</p><h5> Package structure </h5><p><a href="../../../sapi/index.html" class="extype" name="org.apache.daffodil.sapi">org.apache.daffodil.sapi</a> - Provides the classes necessary to compile DFDL schemas, parse and unparse files using the compiled objects, and retrieve results and parsing diagnostics</p><p><a href="../../../udf/index.html" class="extype" name="org.apache.daffodil.udf">org.apache.daffodil.udf</a> - Provides the classes necessary to create User Defined Functions to extend the DFDL expression language</p><p><a href="" class="extype" name="org.apache.daffodil.runtime1.layers.api">org.apache.daffodil.runtime1.layers.api</a> - Provides the classes necessary to create custom Layer extensions to DFDL.</p></div><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../../../../../../index.html" class="extype" name="_root_">root</a></dd></dl></div>
    </li><li name="_root_.org" visbl="pub" class="indented1 " data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="org"></a><a id="org:org"></a>
      <span class="permalink">
      <a href="../../../../../../org/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <a title="" href="../../../../../index.html"><span class="name">org</span></a>
      </span>
      
      <div class="fullcomment"><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../../../../../../index.html" class="extype" name="_root_">root</a></dd></dl></div>
    </li><li name="org.apache" visbl="pub" class="indented2 " data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="apache"></a><a id="apache:apache"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <a title="" href="../../../../index.html"><span class="name">apache</span></a>
      </span>
      
      <div class="fullcomment"><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../../../../../index.html" class="extype" name="org">org</a></dd></dl></div>
    </li><li name="org.apache.daffodil" visbl="pub" class="indented3 " data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="daffodil"></a><a id="daffodil:daffodil"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/daffodil/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <a title="" href="../../../index.html"><span class="name">daffodil</span></a>
      </span>
      
      <div class="fullcomment"><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../../../../index.html" class="extype" name="org.apache">apache</a></dd></dl></div>
    </li><li name="org.apache.daffodil.runtime1" visbl="pub" class="indented4 " data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="runtime1"></a><a id="runtime1:runtime1"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/daffodil/runtime1/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <a title="" href="../../index.html"><span class="name">runtime1</span></a>
      </span>
      
      <div class="fullcomment"><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../../../index.html" class="extype" name="org.apache.daffodil">daffodil</a></dd></dl></div>
    </li><li name="org.apache.daffodil.runtime1.layers" visbl="pub" class="indented5 " data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="layers"></a><a id="layers:layers"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/daffodil/runtime1/layers/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <a title="" href="../index.html"><span class="name">layers</span></a>
      </span>
      
      <div class="fullcomment"><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../../index.html" class="extype" name="org.apache.daffodil.runtime1">runtime1</a></dd></dl></div>
    </li><li name="org.apache.daffodil.runtime1.layers.api" visbl="pub" class="indented6 current" data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="api"></a><a id="api:api"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/daffodil/runtime1/layers/api/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <span class="name">api</span>
      </span>
      
      <div class="fullcomment"><dl class="attributes block"> <dt>Definition Classes</dt><dd><a href="../index.html" class="extype" name="org.apache.daffodil.runtime1.layers">layers</a></dd></dl></div>
    </li><li class="current-entities indented6">
                        <span class="separator"></span>
                        <a class="class" href="ChecksumLayer.html" title="A checksum layer computes a numeric value from a region of the data stream."></a>
                        <a href="ChecksumLayer.html" title="A checksum layer computes a numeric value from a region of the data stream.">ChecksumLayer</a>
                      </li><li class="current-entities indented6">
                        <span class="separator"></span>
                        <a class="class" href="Layer.html" title="This is the primary API class for writing layers."></a>
                        <a href="Layer.html" title="This is the primary API class for writing layers.">Layer</a>
                      </li>
              </ul>
            </div>
          </div>
          <div id="content">
            <body class="package value">
      <div id="definition">
        <div class="big-circle package">p</div>
        <p id="owner"><a href="../../../../../index.html" class="extype" name="org">org</a>.<a href="../../../../index.html" class="extype" name="org.apache">apache</a>.<a href="../../../index.html" class="extype" name="org.apache.daffodil">daffodil</a>.<a href="../../index.html" class="extype" name="org.apache.daffodil.runtime1">runtime1</a>.<a href="../index.html" class="extype" name="org.apache.daffodil.runtime1.layers">layers</a></p>
        <h1>api<span class="permalink">
      <a href="../../../../../../org/apache/daffodil/runtime1/layers/api/index.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span></h1>
        
      </div>

      <h4 id="signature" class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <span class="name">api</span>
      </span>
      </h4>

      
          <div id="comment" class="fullcommenttop"></div>
        

      

      <div id="template">
        <div id="allMembers">
        

        <div id="types" class="types members">
              <h3>Type Members</h3>
              <ol><li name="org.apache.daffodil.runtime1.layers.api.ChecksumLayer" visbl="pub" class="indented0 " data-isabs="true" fullComment="yes" group="Ungrouped">
      <a id="ChecksumLayerextendsChecksumLayerBase"></a><a id="ChecksumLayer:ChecksumLayer"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/daffodil/runtime1/layers/api/ChecksumLayer.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier">abstract </span>
        <span class="kind">class</span>
      </span>
      <span class="symbol">
        <a title="A checksum layer computes a numeric value from a region of the data stream." href="ChecksumLayer.html"><span class="name">ChecksumLayer</span></a><span class="result"> extends <span class="extype" name="org.apache.daffodil.runtime1.layers.ChecksumLayerBase">ChecksumLayerBase</span></span>
      </span>
      
      <p class="shortcomment cmt">A checksum layer computes a numeric value from a region of the data stream.</p><div class="fullcomment"><div class="comment cmt"><p>A checksum layer computes a numeric value from a region of the data stream.</p><p>The term checksum is used generically here to subsume all sorts of CRCs, check digits, data hash, and
digest calculations.</p><p>This abstract base is suitable only for checksums computed over small sections of data.
It is not for large data streams or whole large files.
The entire region of data the checksum is being computed over will be pulled into a byte buffer in memory.</p><p>The resulting checksum is the return value of the <code><a href="ChecksumLayer.html#compute(isUnparse:Boolean,byteBuffer:java.nio.ByteBuffer):Int" class="extmbr" name="org.apache.daffodil.runtime1.layers.api.ChecksumLayer#compute">#compute</a></code> method.</p><p>This result is delivered into a DFDL variable for use by the DFDL schema.
This DFDL variable can have any name such as 'crc', 'digest', or 'dataHash'.</p><p>The derived implementation class must also define a getter method based on the name of the DFDL variable which
will be assigned with the checksum value.
For example if the checksum is actually a specific digest/hash calculation and the DFDL variable is named
<code>digest</code>, then this getter must be defined:
<pre>
<code>
    int getLayerVariableResult_digest() {
      return this.digest; // usually returns a data member
    </code>
}
</pre>
This will be called automatically to retrieve the integer value that was returned from the <code>compute</code> method,
and the DFDL variable named <code>digest</code> will be assigned that value.</p><p>The derived class implementing a checksum layer must call
<pre>
<code>
    setLength(len); // sets the length in bytes
</code>
</pre>
to specify the length of the data region in bytes. Normally this would be called from the layer's implementation of
the <code>setLayerVariableParameters</code> method:
<pre>
<code>
    void setLayerVariableParameters(...) {
        ...
        setLength(len); // len is a constant,
                        // or is computed from a parameter variable
        ...
    </code>
}
</pre>
See the documentation of the <code><a href="Layer.html" class="extype" name="org.apache.daffodil.runtime1.layers.api.Layer">Layer</a></code> class for a description of how DFDL variables are passed to the arguments
of the <code>setLayerVariableParameters</code> method.</p><p>See <code><a href="Layer.html" class="extype" name="org.apache.daffodil.runtime1.layers.api.Layer">Layer</a></code> for more details about layers generally as most of its documentation is
relevant to this derived abstract base class as well.</p></div></div>
    </li><li name="org.apache.daffodil.runtime1.layers.api.Layer" visbl="pub" class="indented0 " data-isabs="true" fullComment="yes" group="Ungrouped">
      <a id="LayerextendsObject"></a><a id="Layer:Layer"></a>
      <span class="permalink">
      <a href="../../../../../../org/apache/daffodil/runtime1/layers/api/Layer.html" title="Permalink">
        <i class="material-icons"></i>
      </a>
    </span>
      <span class="modifier_kind">
        <span class="modifier">abstract </span>
        <span class="kind">class</span>
      </span>
      <span class="symbol">
        <a title="This is the primary API class for writing layers." href="Layer.html"><span class="name">Layer</span></a><span class="result"> extends <span class="extype" name="scala.AnyRef">AnyRef</span></span>
      </span>
      
      <p class="shortcomment cmt">This is the primary API class for writing layers.</p><div class="fullcomment"><div class="comment cmt"><p>This is the primary API class for writing layers.</p><p>All layers are derived from this class.</p><p>This class is used directly as a base class to define <i>transforming</i> layers.
To simplify the
definition of <i>checksum</i> layers, a specialized sub-class
<code><a href="ChecksumLayer.html" class="extype" name="org.apache.daffodil.runtime1.layers.api.ChecksumLayer">org.apache.daffodil.runtime1.layers.api.ChecksumLayer</a></code>
is also available.
Many of the requirements for layers, such as the naming conventions for layer variables,
are described here, but they apply equally to checksum layers.</p><p>Derived classes will be dynamically loaded by Java's Service Provider Interface (SPI) system.
The names of concrete classes derived from Layer are listed in
a metadata resource file
named for this class (that is, the file name is the fully-qualified class name of this class:
<code>resources/META-INF/services/org.apache.daffodil.runtime1.layers.api.Layer</code>).
This file contains lines where each line contains one fully qualified class name of a derived
layer class.
More than one line in the file denotes that the Jar file contains the definitions of more than one derived layer
class.
This file is incorporated in the compiled jar file for the derived <code>Layer</code> class
so that the class path can be searched and Jars containing layer classes can be dynamically loaded.</p><p>The SPI creates an instance the class by calling a default (no-arg) constructor, which should be
the only constructor.</p><p>Instances of derived layer classes can be stateful.
They are private to threads, and each time a layer
is encountered during parse/unparse, an instance is created for that situation.</p><p>Layer instances should not share mutable state (such as via singleton objects).</p><h4> About Layer Variables </h4><p>Layer logic may read and write DFDL variables.
These variables are associated with the layer implementation class by using
Java/Scala reflection to find matches (case-sensitive) between the names of DFDL variables and method
names and method arguments of the layer's Java/Scala code.
Hence, the layer's DFDL variables must have names suitable for use as Java/Scala
identifiers.</p><p>The layer namespace is used only for its layer.
All DFDL variables defined in that namespace are either used to pass parameters to the
layer code, or receive results (such as a checksum) back from the layer code.
This is enforced.
If a layer namespace contains a DFDL variable and there is no corresponding
usage of that variable name in the layer code (following the conventions below), then
it is a Schema Definition Error when the layer code is loaded.</p><p>A layer that does not define any DFDL variables does
not have to define a DFDL schema that defines the layer's target
namespace, but any layer that uses DFDL variables *must* define a
schema with the layer's namespace as its target namespace, and with the
variables declared in it (using <code>dfdl:defineVariable</code>).</p><p>Every DFDL Variable in the layer's target namespace is used either at the start of the
layer algorithm as a parameter to the layer or at the end of the layer algorithm where it is
assigned a return value (such as a checksum or flag) from the layer.</p><p>Variables being read must have values before being read by the layer, and this is true for both
parsing and unparsing.
This happens when the Daffodil processor begins parsing/unparsing the layered sequence.
When unparsing, variables being read cannot be forward-referencing to parts
of the DFDL infoset that have not yet been unparsed.</p><p>A layer that wants to read parameters declares a special setter named
<code>setLayerVariableParameters</code>
which has arguments where each has a name and type that match a corresponding
<code>dfdl:defineVariable</code> in the layer's target namespace.</p><p>For example, if the layer logic has a DFDL variable for a parameter named <code>direction</code>
of type <code>xs:string</code> and another DFDL variable for a parameter named <code>wordCount</code>
of type <code>xs:unsignedShort</code>
then the derived Layer class must have a <code>setLayerVariableParameters</code> with
arguments corresponding in name and type to these two variables.
This setter will be called passing the value of the variables immediately after the layer
instance is constructed.
The arguments to <code>setLayerVariableParameters</code> can be in any order:
<pre>
    void setLayerVariableParameters(String direction, int wordCount) {
        // usually this setter will assign the values to data members
        this.direction = direction;
        this.wordCount = wordCount;
    }
</pre>
Beside initializing local members, this setter is also an initializer for the layer class instance.
Any exception thrown becomes a Schema Definition Error.</p><p>If there are no parameter variables, then this setter, with no arguments, can be used purely for initialization.</p><p>A DFDL variable used to return a result from a layer must be undefined, since variables in DFDL are single-assignment.
Usually this means the use of the layer must be surrounded by a <code>dfdl:newVariableInstance</code>
annotation which creates a new instance of the layer result variable, over a limited scope
of use.
The variable is assigned by the layer, and it is then available for reading by the DFDL schema until
the end of the <code>dfdl:newVariableInstance</code> scope.</p><p>To return a value into a DFDL variable, the layer implementation defines a special recognizable
getter method.
The name of the getter is formed from prefixing the DFDL variable name with the string
&quot;<code>getLayerVariableResult_</code>&quot;.
The return type of the getter must correspond to the type of the variable.</p><p>For example, a result value getter for a DFDL variable named <code>total</code> of type <code>xs:unsignedShort</code> would be:
<pre>
<code>
     int getLayerVariableResult_total() {
         // returns the value created by the layer's algorithm.
         // commonly this returns the value of a data member.
         return this.total;
     </code>
}
</pre>
Layers could have multiple result variables, but a single variable is most common, generally for returning checksums.
See the <code><a href="ChecksumLayer.html" class="extype" name="org.apache.daffodil.runtime1.layers.api.ChecksumLayer">ChecksumLayer</a></code> class, which is designed to facilitate creation of checksum/CRC/hash/digest layers.</p><p>The Java types to use for the setter arguments and getter return types correspond to the DFDL variable types
according to this table:
<table border="1">
    <tr>
        <th>DFDL Schema Type</th>
        <th>Java Type</th>
    </tr>
    <tr>
        <td>xs:byte</td>
        <td>byte</td>
    </tr>
    <tr>
        <td>xs:short</td>
        <td>short</td>
    </tr>
    <tr>
        <td>xs:int</td>
        <td>int</td>
    </tr>
    <tr>
        <td>xs:long</td>
        <td>long</td>
    </tr>
    <tr>
        <td>xs:integer</td>
        <td>java.math.BigInteger</td>
    </tr>
    <tr>
        <td>xs:decimal</td>
        <td>java.math.BigDecimal</td>
    </tr>
    <tr>
        <td>xs:unsignedInt</td>
        <td>long</td>
    </tr>
    <tr>
        <td>xs:unsignedByte</td>
        <td>short</td>
    </tr>
    <tr>
        <td>xs:unsignedShort</td>
        <td>int</td>
    </tr>
    <tr>
        <td>xs:unsignedLong</td>
        <td>java.math.BigInteger</td>
    </tr>
    <tr>
        <td>xs:nonNegativeInteger</td>
        <td>java.math.BigInteger</td>
    </tr>
    <tr>
        <td>xs:double</td>
        <td>double</td>
    </tr>
    <tr>
        <td>xs:float</td>
        <td>float</td>
    </tr>
    <tr>
        <td>xs:hexBinary</td>
        <td>byte[]</td>
    </tr>
    <tr>
        <td>xs:anyURI</td>
        <td>java.net.URI</td>
    </tr>
    <tr>
        <td>xs:boolean</td>
        <td>boolean</td>
    </tr>
    <tr>
        <td>xs:dateTime</td>
        <td>com.ibm.icu.util.ICUCalendar</td>
    </tr>
    <tr>
        <td>xs:date</td>
        <td>com.ibm.icu.util.ICUCalendar</td>
    </tr>
    <tr>
        <td>xs:time</td>
        <td>com.ibm.icu.util.ICUCalendar</td>
    </tr>
    <caption style="caption-side:bottom"></caption>
</table></p><h4> Layer Algorithm </h4><p>The rest of the Layer class implements the layer decode/encode logic.</p><p>The actual algorithm of the layer is not implemented in methods of the derived layer class, but rather is
implemented in the layer's <i>input decoder</i> and <i>output encoder</i>.
These extend the <code>java.io.InputStream</code> and <code>java.io.OutputStream</code> base classes to actually handle the
data.</p><p>Every layer must implement the <code><a href="Layer.html#wrapLayerInput(jis:java.io.InputStream):java.io.InputStream" class="extmbr" name="org.apache.daffodil.runtime1.layers.api.Layer#wrapLayerInput">#wrapLayerInput</a></code> and <code><a href="Layer.html#wrapLayerOutput(jos:java.io.OutputStream):java.io.OutputStream" class="extmbr" name="org.apache.daffodil.runtime1.layers.api.Layer#wrapLayerOutput">#wrapLayerOutput</a></code>
methods, which provide the input decoder and output encoder instances to the Daffodil layer framework.
When parsing/unparsing, the derived Layer class itself is concerned with setup and tear-down of the
layer's input decoder and output encoder, with providing access to/from DFDL variables,
and with reporting errors effectively.</p><h5>  Layer Exception Handling  </h5><p>The method <code>setProcessingErrorException </code> allows the layer to specify that if the layer throws specific
exceptions or runtime exceptions that they are converted into processing errors.
This eliminates most need for layer code to contain try-catches.
For example:
<pre>
<code>
    setProcessingErrorException(IOException.class);
</code>
</pre>
informs the DFDL processor that an IOException thrown from the layer is to be treated as a processing error.</p><p>Unhandled exceptions thrown by the layer code are treated as fatal errors.
</p></div></div>
    </li></ol>
            </div>

        

        

        

        
        </div>

        <div id="inheritedMembers">
        
        
        </div>

        <div id="groupedMembers">
        <div class="group" name="Ungrouped">
              <h3>Ungrouped</h3>
              
            </div>
        </div>

      </div>

      <div id="tooltip"></div>

      <div id="footer">  </div>
    </body>
          </div>
        </div>
      </div>
    </body>
      </html>
