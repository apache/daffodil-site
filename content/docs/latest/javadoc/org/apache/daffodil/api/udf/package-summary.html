<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>org.apache.daffodil.api.udf (Apache Daffodil 4.0.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: org.apache.daffodil.api.udf">
<meta name="generator" content="javadoc/PackageWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#package">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Package:&nbsp;</li>
<li><a href="#package-description">Description</a>&nbsp;|&nbsp;</li>
<li><a href="#related-package-summary">Related Packages</a>&nbsp;|&nbsp;</li>
<li><a href="#class-summary">Classes and Interfaces</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 title="Package org.apache.daffodil.api.udf" class="title">Package org.apache.daffodil.api.udf</h1>
</div>
<hr>
<div class="package-signature">package <span class="element-name">org.apache.daffodil.api.udf</span></div>
<section class="package-description" id="package-description">
<div class="block"><h2>User Defined Functions</h2>

 <h3>Introduction</h3>
 <p>
 Apache Daffodil allows execution of Java/Scala external (user defined) functions in DFDL expressions.
 </p>

 <h3>Getting Started</h3>
 <p>
 Provide a JAR on the classpath (or Daffodil classpath) that contains at least two kinds of classes:
 a <em>provider</em> class and its associated user-defined function (UDF) class(es). All providers must be
 registered in the file
 <code>META-INF/services/org.apache.daffodil.api.udf.UserDefinedFunctionProvider</code>, regardless of how many
 providers or UDFs are included.
 </p>

 <h4>UDF Implementation</h4>

 <h5>User Defined Function Provider Classes</h5>
 <p>
 The provider class must extend Daffodil's <code>UserDefinedFunctionProvider</code>. It must implement the
 <code>getUserDefinedFunctionClasses()</code> abstract method and return every User Defined Function the provider supplies. The base provider offers
 <code>createUserDefinedFunction(namespaceURI, name)</code> to look up and instantiate UDFs that have a no‑argument
 constructor. If a UDF requires constructor arguments, override the lookup to construct it appropriately.
 </p>
 <p>
 Providers participate in Java’s <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ServiceLoader.html" title="class or interface in java.util" class="external-link"><code>ServiceLoader</code></a> mechanism and therefore <strong>must</strong> include
 a file named <code>META-INF/services/org.apache.daffodil.api.udf.UserDefinedFunctionProvider</code> listing the
 fully qualified names of the provider class(es) contained in the JAR. Without this file, neither the provider nor
 its UDFs will be visible to Daffodil.
 </p>

 <h5>User Defined Function Classes</h5>
 <p>
 Each UDF class must extend Daffodil's <code>UserDefinedFunction</code>. It contains the functionality to be used in DFDL
 expressions and must be annotated with <code>UserDefinedFunctionIdentification</code>, supplying the UDF invocation
 <code>name</code> and <code>namespaceURI</code>. A method named <code>evaluate(...)</code> must be implemented; it is what Daffodil
 calls to execute the UDF. <strong>Overloaded</strong> or <strong>void</strong> <code>evaluate</code> methods are not
 supported.
 </p>

 <h5>User Defined Function Exceptions</h5>
 <ul>
   <li><code>UserDefinedFunctionProcessingError</code>: throw to request backtracking during parsing.</li>
   <li><code>UserDefinedFunctionFatalException</code>: throw to abort processing entirely.</li>
 </ul>
 <p>
 Any other exception type is treated as <code>UserDefinedFunctionFatalException</code>.
 </p>

 <h4>UDF Registration</h4>
 <p>Typical project layouts:</p>

 <p><strong>Scala (sbt-style):</strong></p>
 <pre><code>
 src/
   main/
     scala/
       org/
         sgoodudfs/
           example/
             StringFunctions/
               StringFunctionsProvider.scala  // UDF provider (may contain UDF classes or define them separately)
     resources/
       META-INF/
         services/
           org.apache.daffodil.api.udf.UserDefinedFunctionProvider
 </code></pre>

 <p><strong>Java (generic):</strong></p>
 <pre><code>
 src/
   org/
     jgoodudfs/
       example/
         StringFunctions/
           StringFunctionsProvider.java  // UDF provider
           Compare.java                  // UDF class
           Replace.java                  // UDF class
   META-INF/
     services/
       org.apache.daffodil.api.udf.UserDefinedFunctionProvider
 </code></pre>

 <p>
 Each UDF is registered by listing the provider’s fully qualified class name in the text file
 <code>META-INF/services/org.apache.daffodil.api.udf.UserDefinedFunctionProvider</code>. The <code>META-INF</code>
 folder must be discoverable from the classpath root or the ServiceLoader will not find it.
 </p>

 <h4>UDF Usage</h4>
 <p>
 In your DFDL schema, define an xsd namespace or set the default namespace to match the UDF’s annotation <code>namespaceURI</code>, then
 invoke using the annotated <code>name</code>. For example:
 </p>
 <pre><code>
 // annotation on the UDF class
  UserDefinedFunctionIdentification(  
    name = "replace",
    namespaceURI = "http://example.com/ext/stringfunctions") 
 
 // within the schema tag
 xmlns:sdf="http://example.com/ext/stringfunctions"
   
 // within the DFDL expression
 ..."{ sdf:replace(., ' ', '_') }"...
 </code></pre>


 <h3>Supported Types</h3>
 <ul>
   <li>BigDecimal (Java)</li>
   <li>BigInteger (Java)</li>
   <li>Boolean (boxed and primitive)</li>
   <li>Byte (boxed, primitive, array of primitive)</li>
   <li>Double (boxed and primitive)</li>
   <li>Float (boxed and primitive)</li>
   <li>Integer (boxed and primitive)</li>
   <li>Long (boxed and primitive)</li>
   <li>Short (boxed and primitive)</li>
   <li>String</li>
 </ul>

 <h3>Restrictions</h3>
 <ul>
   <li>Overloading unsupported</li>
   <li>Void <code>evaluate</code> functions unsupported</li>
 </ul></div>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div id="related-package-summary">
<div class="caption"><span>Related Packages</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Package</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><a href="../package-summary.html">org.apache.daffodil.api</a></div>
<div class="col-last even-row-color">
<div class="block">Provides the classes necessary to compile DFDL schemas, parse and
 unparse files using the compiled objects, and retrieve results and
 parsing diagnostics</div>
</div>
<div class="col-first odd-row-color"><a href="exceptions/package-summary.html">org.apache.daffodil.api.udf.exceptions</a></div>
<div class="col-last odd-row-color">&nbsp;</div>
</div>
</div>
</li>
<li>
<div id="class-summary">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="class-summary-tab0" role="tab" aria-selected="true" aria-controls="class-summary.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary', 2)" class="active-table-tab">All Classes and Interfaces</button><button id="class-summary-tab1" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab1', 2)" class="table-tab">Interfaces</button><button id="class-summary-tab2" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab2', 2)" class="table-tab">Classes</button><button id="class-summary-tab7" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab7', 2)" class="table-tab">Annotation Interfaces</button></div>
<div id="class-summary.tabpanel" role="tabpanel" aria-labelledby="class-summary-tab0">
<div class="summary-table two-column-summary">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab1"><a href="UserDefinedFunction.html" title="interface in org.apache.daffodil.api.udf">UserDefinedFunction</a></div>
<div class="col-last even-row-color class-summary class-summary-tab1">
<div class="block">Interface that all User Defined Functions classes must implement.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab7"><a href="UserDefinedFunctionIdentification.html" title="annotation interface in org.apache.daffodil.api.udf">UserDefinedFunctionIdentification</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab7">
<div class="block">Annotation that must be applied to every UDF in order for it to be considered
 valid.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="UserDefinedFunctionProvider.html" title="class in org.apache.daffodil.api.udf">UserDefinedFunctionProvider</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">Abstract class used by ServiceLoader to poll for UDF providers on classpath.</div>
</div>
</div>
</div>
</div>
</li>
</ul>
</section>
</main>
</div>
</div>
</body>
</html>
