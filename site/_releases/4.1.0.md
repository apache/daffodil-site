---
title: "4.1.0"
release: rc1
apache: true
date: 2026-01-28
summary: >
  Bug fixes and performance improvements

source-dist:
 - "apache-daffodil-4.1.0-src.zip"

binary-dist:
 - "apache-daffodil-4.1.0-bin.tgz"
 - "apache-daffodil-4.1.0-bin.zip"
 - "apache-daffodil-4.1.0-bin.exe"
 - "apache-daffodil-4.1.0-1.noarch.rpm"

scala-version: 3
---

This release focused on bugs fixed and performance improvements. A number of
changes resulted in deprecation or backwards incompatible changes. See
[Deprecation/Compatibility](#deprecationcompatibility) section for more
details. 

This release requires Java 17 or newer, and Scala 3.3.x. It was tested with
Java 17, 21, and 25, and Scala 3.3.7. We recommened Java 25 for best
performance.

# Miscellaneous Bugs/Improvements

* {% jira 1392 %} escapeBlockStart partial match incorrectly drops characters
* {% jira 1590 %} setVar evaluates before element terminator
* {% jira 2217 %} trailingEmptyStrict not being strict in this case
* {% jira 2287 %} JApi throws checked exceptions without declaring
* {% jira 2295 %} priorAlignmentApprox incorrect if term is preceded by separator with text bit alignment
* {% jira 2324 %} Unparser choice branch selection not conformant to DFDL standard
* {% jira 2539 %} Duplicate TDML file - rename, and remove overlapping tests and schemas
* {% jira 2574 %} Cast error when multiplying two unsignedBytes
* {% jira 2768 %} SAX unparse can lead to a hanging thread if the XMLReader stops sending events
* {% jira 2769 %} update unimplemented features page for 4.0.0 release
* {% jira 2801 %} Array with Choice parses incorrectly when occursCountKind is implicit
* {% jira 2812 %} Exclude xml-apis from transitive dependencies
* {% jira 2851 %} Excessive allocations in StringOfSpecifiedLengthMixin
* {% jira 2855 %} Scoping different when using dfdlx:repType vs type
* {% jira 2939 %} Remove UpMoveArray
* {% jira 2957 %} dfdl:decimalSigned="no" bugs with negative values and data representations
* {% jira 2963 %} decimalSigned boolean not passed into PackedDecimal* parsers
* {% jira 2974 %} dfdlx:currentPosition() function for experiments
* {% jira 2985 %} Remove ICU workaround related to decimal inf/nan and textNumberCheckPolicy strict
* {% jira 2993 %} Support SBOM/SPDX
* {% jira 2998 %} Convert DFDL Schema Style Guide into a daffodil site page
* {% jira 3005 %} exi options to CLI are not documented on site
* {% jira 3040 %} Release Candidate Workflow artifact should not contain files already in svn
* {% jira 3041 %} Make SVN/NEXUS Credential Vars optional if not publishing
* {% jira 3043 %} Update Site to new Logo and Branding for ASF
* {% jira 3044 %} create LTS DFDL-extension documentation on daffodil-site
* {% jira 3046 %} create DFDL training page on daffodil-site
* {% jira 3047 %} Review/Contribute to next ISO/OGF DFDL Spec version
* {% jira 3049 %} bitAnd, bitOr, bitXor args not properly restricted
* {% jira 3051 %} Add Java 25 to CI
* {% jira 3052 %} site menu and content fixes
* {% jira 3053 %} Links to API doc broken on Layers page
* {% jira 3055 %} Update release-candidate action to use getExecOutput instead of exec
* {% jira 3056 %} priorAlignmentWithLeadingSkipApprox has incomplete implementation
* {% jira 3057 %} endingAlignment has incomplete implementation
* {% jira 3058 %} Remove old release candidate container
* {% jira 3062 %} Disable JIRA notifications from GitHub pull requests
* {% jira 3064 %} Reduce Future allocation in CLI performance command

# Deprecation/Compatibility


* {% jira 2287 %} JApi throws checked exceptions without declaring

  Previously Daffodil did not declare some checked exceptions that could have
  been thrown by some Daffodil API functions. Those are now declared, which
  requires users of the API to explicitly catch these exceptions or mark them as
  thrown.

* {% jira 2287 %} JApi throws checked exceptions without declaring

  dfdl:outputValueCalc is now allowed on global/root elements

* {% jira 2939 %} Remove UpMoveArray

  DFDL expressions with an upward path step (`..`) to an array is deprecated and
  now results in a schema definition warning. Future versions of Daffodil may
  remove support for this and result in a schema definition error.

* {% jira 2324 %} Unparser choice branch selection not conformant to DFDL standard

  Per DFDL errata 5.60, the first branch that can be unparsed entirely without
  any infoset events (i.e. made up of elements that are dfdl:outputValueCalc,
  option branches, zero length arrays, or defaultable elements) in a choice is
  selected, rather than prioritizing the first empty branch. Also, required
  arrays are no longer treated as optional and hidden IVCs are only permissible
  in choices.

* {% jira 2855 %} Scoping different when using dfdlx:repType vs type

  When resolving default properties, Daffodil now gives precedence to innermost
  referenced schema components rather than the outermost, as described by section
  8.1.4 of the DFDL specification. If this new logic results in a different
  property value than previous versions of Daffodil then a schema definition
  warning is issued.

* {% jira 2957 %} dfdl:decimalSigned="no" bugs with negative values and data representations

  Daffodil now errors when dfdl:decimalSigned=no or dfdl:decimalSigned is
  not applicable (as in the case of BCD numbers, which are always positive), but
  an attempt is made to parse to/unparse a negative number

* {% jira 2768 %} SAX unparse can lead to a hanging thread if the XMLReader stops sending events

  The DaffodilUnhandledSAXException, which can be thrown when unparsing using the
  SAX API and usually indicates a Daffodil bug, is changed from a SAXException to
  a RuntimeException. It is no longer a checked exception and does not need to be
  caught. It should usually be handled just like any other unchecked
  RuntimeException.

  When unparsing using the SAX API, `DaffodilUnparseContentHandler.finish()`
  should be called after `xmlReader.parse(...)` returns, regardless of success,
  to ensure all resources are cleaned up. For example:

  ```java
  DaffodilUnparseContentHandler contentHandler = dp.newContentHandlerInstance(...);
  xmlReader.setContentHandler(contentHandler);
  try {
    xmlReader.parse(...);
  } catch (...) {
    ...
  } finally {
    contentHandler.finish();
  }
  ```

# Dependency Changes

The following dependencies have been added, updated, or removed:

## Core

* Apache Commons IO 2.21.0 <small>(update)</small>
* ICU4J 78.2 <small>(update)</small>
* Scala Library 3.3.7 <small>(updated)</small>
* Scala Logging 3.3.6 <small>(update)</small>

## Code Generation

* OS Lib 0.11.6 <small>(update)</small>
* OS Zip 0.11.6 <small>(update)</small>

## Command Line Interface

* JLine 3.30.6 <small>(update)</small>
* Scallop 5.3.0 <small>(update)</small>

## Schematron Validator

* Saxon-HE 12.9 <small>(update)</small>
* XML APIs 1.4.01 <small>(removed)</small>
